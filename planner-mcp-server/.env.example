# Multi-Tenant Microsoft Graph API Configuration
# Story 2.1 Task 4: Multi-tenant support environment configuration

# =============================================================================
# CORE MULTI-TENANT SETTINGS
# =============================================================================

# Enable multi-tenant functionality
MULTI_TENANT_ENABLED=true

# Default tenant configuration (Azure AD tenant)
DEFAULT_TENANT_ID=12345678-1234-1234-1234-123456789012
DEFAULT_TENANT_NAME=Primary Organization

# Enable strict tenant isolation
TENANT_ISOLATION_ENABLED=true

# =============================================================================
# DEFAULT TENANT CONFIGURATION (Primary Azure AD)
# =============================================================================

# Azure AD Application Registration
AZURE_CLIENT_ID=87654321-4321-4321-4321-210987654321
AZURE_CLIENT_SECRET=your_primary_client_secret_here
AZURE_TENANT_ID=${DEFAULT_TENANT_ID}
AZURE_AUTHORITY=https://login.microsoftonline.com/${AZURE_TENANT_ID}

# Default tenant resource limits
DEFAULT_RATE_LIMIT=2000
DEFAULT_MAX_REQUESTS=1500
DEFAULT_MAX_BATCH_SIZE=25
DEFAULT_MAX_CONCURRENT=15
DEFAULT_STORAGE_QUOTA_MB=2000

# Default tenant scopes
DEFAULT_TENANT_SCOPES=https://graph.microsoft.com/Group.Read.All,https://graph.microsoft.com/Tasks.ReadWrite,https://graph.microsoft.com/User.Read

# Default security policies
DEFAULT_REQUIRE_MFA=false
DEFAULT_ALLOWED_IPS=
DEFAULT_SESSION_TIMEOUT=3600

# =============================================================================
# ADDITIONAL TENANT CONFIGURATIONS
# =============================================================================

# Tenant 2: Secondary Organization
TENANT_2_ID=98765432-5678-5678-5678-876543210987
TENANT_2_NAME=Secondary Organization
TENANT_2_CLIENT_ID=13579246-8642-8642-8642-135792468024
TENANT_2_CLIENT_SECRET=your_secondary_client_secret_here
TENANT_2_AUTHORITY=https://login.microsoftonline.com/${TENANT_2_ID}
TENANT_2_RATE_LIMIT=1000
TENANT_2_MAX_REQUESTS=800
TENANT_2_MAX_BATCH_SIZE=15
TENANT_2_MAX_CONCURRENT=8
TENANT_2_STORAGE_QUOTA_MB=1000
TENANT_2_SCOPES=https://graph.microsoft.com/User.Read,https://graph.microsoft.com/Files.ReadWrite,https://graph.microsoft.com/Calendars.Read
TENANT_2_REQUIRE_MFA=true
TENANT_2_ALLOWED_IPS=192.168.1.0/24,10.0.0.0/8
TENANT_2_SESSION_TIMEOUT=1800

# Tenant 3: Enterprise Organization
TENANT_3_ID=11111111-2222-3333-4444-555555555555
TENANT_3_NAME=Enterprise Solutions Ltd
TENANT_3_CLIENT_ID=66666666-7777-8888-9999-000000000000
TENANT_3_CLIENT_SECRET=your_enterprise_client_secret_here
TENANT_3_AUTHORITY=https://login.microsoftonline.com/${TENANT_3_ID}
TENANT_3_RATE_LIMIT=3000
TENANT_3_MAX_REQUESTS=2500
TENANT_3_MAX_BATCH_SIZE=30
TENANT_3_MAX_CONCURRENT=20
TENANT_3_STORAGE_QUOTA_MB=5000
TENANT_3_SCOPES=https://graph.microsoft.com/Directory.Read.All,https://graph.microsoft.com/Application.ReadWrite.All,https://graph.microsoft.com/Group.ReadWrite.All
TENANT_3_REQUIRE_MFA=true
TENANT_3_ALLOWED_IPS=
TENANT_3_SESSION_TIMEOUT=7200

# =============================================================================
# GLOBAL SECURITY POLICIES
# =============================================================================

# Tenant validation requirements
REQUIRE_TENANT_VALIDATION=true

# Cross-tenant access control
ALLOW_CROSS_TENANT_ACCESS=false

# Scope restriction enforcement
ENFORCE_SCOPE_RESTRICTIONS=true

# Audit logging for all operations
AUDIT_ALL_OPERATIONS=true

# Maximum tenant idle time (days)
MAX_TENANT_IDLE_DAYS=90

# Require encryption for sensitive data
REQUIRE_ENCRYPTION=true

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================

# Global rate limiting settings
RATE_LIMIT_ENABLED=true
RATE_LIMIT_ADAPTIVE=true
RATE_LIMIT_STRATEGY=exponential_backoff
RATE_LIMIT_PREDICTIVE=true
RATE_LIMIT_JITTER=true

# Exponential backoff configuration
EXPONENTIAL_BACKOFF_BASE=2.0
EXPONENTIAL_BACKOFF_MAX=300.0

# Circuit breaker settings
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60

# =============================================================================
# ENVIRONMENT AND DEPLOYMENT
# =============================================================================

# Application environment
ENVIRONMENT=production

# Encryption key for token storage (32 characters required)
ENCRYPTION_KEY=your_32_character_encryption_key_

# Cache and performance settings
CACHE_TTL_DEFAULT=3600
CACHE_TTL_TOKENS=1800
PERFORMANCE_MONITORING=true

# =============================================================================
# MICROSOFT GRAPH API SETTINGS
# =============================================================================

# Graph API endpoint
GRAPH_API_ENDPOINT=https://graph.microsoft.com/v1.0

# Default timeout settings
HTTP_TIMEOUT=30
CONNECTION_TIMEOUT=10
READ_TIMEOUT=30

# Retry configuration
MAX_RETRIES=3
RETRY_DELAY=1.0

# =============================================================================
# LOGGING AND MONITORING
# =============================================================================

# Log level configuration
LOG_LEVEL=INFO
LOG_FORMAT=json

# Audit log retention
AUDIT_LOG_RETENTION_DAYS=365

# Performance metrics
METRICS_ENABLED=true
METRICS_RETENTION_HOURS=168

# =============================================================================
# WEBHOOK AND SUBSCRIPTION SETTINGS
# =============================================================================

# Webhook Configuration - Core Settings
WEBHOOK_BASE_URL=https://your-app.com/webhooks
WEBHOOK_SECRET=your_webhook_verification_secret_key_256bits
WEBHOOK_SUBSCRIPTION_RENEWAL_BUFFER=86400  # 24 hours in seconds
WEBHOOK_VALIDATION_TOKEN_TIMEOUT=300  # 5 minutes in seconds
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_RETRY_DELAY=60  # seconds between retries
WEBHOOK_NOTIFICATION_TIMEOUT=30  # seconds
WEBHOOK_SIGNATURE_ALGORITHM=HMAC-SHA256

# Subscription Management
SUBSCRIPTION_RENEWAL_BUFFER_HOURS=24
MAX_SUBSCRIPTIONS_PER_TENANT=10
WEBHOOK_MAX_EXPIRATION_HOURS=8760  # 1 year maximum
WEBHOOK_DEFAULT_EXPIRATION_HOURS=168  # 7 days default

# Multi-tenant Webhook Isolation
WEBHOOK_TENANT_ISOLATION_ENABLED=true
WEBHOOK_ENFORCE_TENANT_VALIDATION=true

# Webhook Security Settings
WEBHOOK_REQUIRE_HTTPS=true
WEBHOOK_REQUIRE_SIGNATURE_VALIDATION=true
WEBHOOK_ALLOWED_IPS=  # Comma-separated list of allowed IPs (empty = allow all)
WEBHOOK_RATE_LIMIT_PER_MINUTE=100
WEBHOOK_MAX_PAYLOAD_SIZE_MB=10

# Notification Processing
WEBHOOK_NOTIFICATION_QUEUE_SIZE=1000
WEBHOOK_NOTIFICATION_BATCH_SIZE=10
WEBHOOK_NOTIFICATION_PROCESSING_TIMEOUT=120  # seconds
WEBHOOK_ENABLE_DEDUPLICATION=true
WEBHOOK_DEDUPLICATION_WINDOW_SECONDS=300

# Background Task Configuration
WEBHOOK_RENEWAL_CHECK_INTERVAL=3600  # Check every hour
WEBHOOK_CLEANUP_EXPIRED_INTERVAL=86400  # Daily cleanup
WEBHOOK_NOTIFICATION_PROCESSOR_WORKERS=3

# Microsoft Graph Webhook Resources
WEBHOOK_SUPPORTED_RESOURCES=planner/plans,planner/tasks,groups,users
WEBHOOK_SUPPORTED_CHANGE_TYPES=created,updated,deleted
WEBHOOK_INCLUDE_RESOURCE_DATA_DEFAULT=false

# Webhook Monitoring and Health
WEBHOOK_HEALTH_CHECK_ENABLED=true
WEBHOOK_METRICS_ENABLED=true
WEBHOOK_STATISTICS_RETENTION_DAYS=30
WEBHOOK_ALERT_ON_FAILED_NOTIFICATIONS=true
WEBHOOK_ALERT_THRESHOLD_FAILURES=5

# Development and Testing
WEBHOOK_MOCK_GRAPH_SUBSCRIPTIONS=false  # Set to true for testing without Graph API
WEBHOOK_LOG_ALL_NOTIFICATIONS=false  # Set to true for debugging
WEBHOOK_VALIDATE_NOTIFICATION_SCHEMA=true

# =============================================================================
# DATABASE AND STORAGE
# =============================================================================

# Database connection (if using persistent storage)
DATABASE_URL=postgresql://user:password@localhost:5432/planner_db

# Redis cache configuration
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=your_redis_password

# File storage configuration
STORAGE_PROVIDER=azure_blob
STORAGE_CONNECTION_STRING=your_storage_connection_string

# =============================================================================
# DEVELOPMENT AND TESTING
# =============================================================================

# Development mode settings
DEBUG=false
DEVELOPMENT_MODE=false

# Testing configuration
TEST_MODE=false
MOCK_GRAPH_API=false

# Local development overrides
LOCAL_DEVELOPMENT=false
SKIP_SSL_VERIFICATION=false

# =============================================================================
# COMPLIANCE AND GOVERNANCE
# =============================================================================

# Data residency settings
DATA_RESIDENCY_REGION=US
GDPR_COMPLIANCE_ENABLED=true

# Compliance reporting
COMPLIANCE_REPORTING_ENABLED=true
COMPLIANCE_REPORT_INTERVAL_HOURS=24

# Data retention policies
USER_DATA_RETENTION_DAYS=2555  # 7 years
AUDIT_DATA_RETENTION_DAYS=2190  # 6 years
TEMP_DATA_RETENTION_HOURS=24

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Backup configuration
BACKUP_ENABLED=true
BACKUP_INTERVAL_HOURS=6
BACKUP_RETENTION_DAYS=30

# Disaster recovery
DR_ENABLED=true
DR_FAILOVER_TIMEOUT=300

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Connection pooling
MAX_POOL_SIZE=20
MIN_POOL_SIZE=5
POOL_TIMEOUT=30

# Memory and CPU limits
MAX_MEMORY_MB=2048
MAX_CPU_CORES=4

# Async processing
MAX_CONCURRENT_TASKS=50
TASK_QUEUE_SIZE=1000

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Advanced features
BATCH_OPERATIONS_ENABLED=true
DELTA_QUERIES_ENABLED=true
WEBHOOKS_ENABLED=true
ADVANCED_CACHING_ENABLED=true

# Experimental features
PREDICTIVE_CACHING=false
AI_ENHANCED_ROUTING=false
ADVANCED_ANALYTICS=false

# =============================================================================
# DELTA QUERY CONFIGURATION
# =============================================================================

# Delta Query Configuration
DELTA_QUERY_ENABLED=true
DELTA_TOKEN_STORAGE_TYPE=database
DELTA_TOKEN_TTL=86400
DELTA_SYNC_INTERVAL=300
DELTA_FALLBACK_THRESHOLD=10
DELTA_MAX_PAGE_SIZE=999
DELTA_RETRY_ATTEMPTS=3
DELTA_RETRY_DELAY=1.0
DELTA_MAX_CONCURRENT_SYNCS=5
DELTA_ENABLE_CHANGE_TRACKING=true
DELTA_ENABLE_CONFLICT_RESOLUTION=true

# File storage settings (when using file-based token storage)
DELTA_TOKEN_FILE_DIR=/tmp/delta_tokens

# =============================================================================
# NOTIFICATION SETTINGS
# =============================================================================

# Email notifications
SMTP_HOST=smtp.your-provider.com
SMTP_PORT=587
SMTP_USERNAME=your_smtp_username
SMTP_PASSWORD=your_smtp_password
SMTP_FROM_ADDRESS=noreply@your-domain.com

# Slack notifications
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
SLACK_CHANNEL=#alerts

# Teams notifications
TEAMS_WEBHOOK_URL=https://your-org.webhook.office.com/webhookb2/YOUR-TEAMS-WEBHOOK